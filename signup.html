<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up | Your Site</title>
    <link rel="stylesheet" href="signup.css" />
  </head>
  <body>
    <div class="signup-container">
      <div class="signup-header">
        <a href="index.html">
          <img
            src="https://mrgovernment-max.github.io/e-commerce-portfolio/images/logo.webp"
            alt="Brand Logo"
            class="logo"
        /></a>
        <h1>Create Account</h1>
        <p>Join our community today</p>
      </div>

      <form class="signup-form" id="signupForm">
        <div class="form-row">
          <div class="form-group">
            <label for="userName">First Name</label>
            <input
              type="text"
              id="userName"
              class="form-control"
              placeholder="Enter Username"
              required
            />
          </div>
        </div>

        <div class="form-group">
          <label for="email">Email Address</label>
          <input
            type="email"
            id="email"
            class="form-control"
            placeholder="Enter your email"
            required
          />
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div class="password-container">
            <input
              type="password"
              id="password"
              class="form-control"
              placeholder="Create a password"
              required
            />
            <button type="button" class="toggle-password" id="togglePassword">
              üëÅÔ∏è
            </button>
          </div>
          <div class="password-strength">
            <div class="password-strength-bar" id="passwordStrengthBar"></div>
          </div>
          <div class="password-hints">
            <ul>
              <li id="lengthHint">At least 8 characters</li>
              <li id="uppercaseHint">One uppercase letter</li>
              <li id="numberHint">One number</li>
              <li id="specialHint">One special character</li>
            </ul>
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <div class="password-container">
            <input
              type="password"
              id="confirmPassword"
              class="form-control"
              placeholder="Confirm your password"
              required
            />
            <button
              type="button"
              class="toggle-password"
              id="toggleConfirmPassword"
            >
              üëÅÔ∏è
            </button>
          </div>
          <div
            id="passwordMatch"
            style="font-size: 14px; margin-top: 5px"
          ></div>
        </div>

        <div class="terms-privacy">
          <input type="checkbox" id="terms" required />
          <label for="terms"
            >I agree to the <a href="#">Terms of Service</a> and
            <a href="#">Privacy Policy</a></label
          >
        </div>

        <button type="submit" class="signup-btn">Create Account</button>
        <section class="msg-display" id="msg-display"></section>

        <div class="login-link">
          Already have an account? <a href="login.html">Sign In</a>
        </div>
      </form>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const signupForm = document.getElementById("signupForm");
        const togglePassword = document.getElementById("togglePassword");
        const toggleConfirmPassword = document.getElementById(
          "toggleConfirmPassword"
        );
        const passwordInput = document.getElementById("password");
        const confirmPasswordInput = document.getElementById("confirmPassword");
        const passwordStrengthBar = document.getElementById(
          "passwordStrengthBar"
        );
        const passwordMatch = document.getElementById("passwordMatch");

        // Password strength indicators
        const lengthHint = document.getElementById("lengthHint");
        const uppercaseHint = document.getElementById("uppercaseHint");
        const numberHint = document.getElementById("numberHint");
        const specialHint = document.getElementById("specialHint");

        // Toggle password visibility
        togglePassword.addEventListener("click", function () {
          const type =
            passwordInput.getAttribute("type") === "password"
              ? "text"
              : "password";
          passwordInput.setAttribute("type", type);
          this.textContent = type === "password" ? "üëÅÔ∏è" : "üîí";
        });

        // Toggle confirm password visibility
        toggleConfirmPassword.addEventListener("click", function () {
          const type =
            confirmPasswordInput.getAttribute("type") === "password"
              ? "text"
              : "password";
          confirmPasswordInput.setAttribute("type", type);
          this.textContent = type === "password" ? "üëÅÔ∏è" : "üîí";
        });

        // Check password strength
        passwordInput.addEventListener("input", function () {
          const password = this.value;
          let strength = 0;

          // Check password length
          if (password.length >= 8) {
            strength += 25;
            lengthHint.classList.add("valid");
          } else {
            lengthHint.classList.remove("valid");
          }

          // Check for uppercase letters
          if (/[A-Z]/.test(password)) {
            strength += 25;
            uppercaseHint.classList.add("valid");
          } else {
            uppercaseHint.classList.remove("valid");
          }

          // Check for numbers
          if (/[0-9]/.test(password)) {
            strength += 25;
            numberHint.classList.add("valid");
          } else {
            numberHint.classList.remove("valid");
          }

          // Check for special characters
          if (/[^A-Za-z0-9]/.test(password)) {
            strength += 25;
            specialHint.classList.add("valid");
          } else {
            specialHint.classList.remove("valid");
          }

          // Update strength bar
          passwordStrengthBar.style.width = strength + "%";

          // Update bar color
          if (strength < 50) {
            passwordStrengthBar.style.backgroundColor = "#dc3545";
          } else if (strength < 75) {
            passwordStrengthBar.style.backgroundColor = "#ffc107";
          } else {
            passwordStrengthBar.style.backgroundColor = "#28a745";
          }

          // Check if passwords match
          checkPasswordMatch();
        });

        // Check if passwords match
        confirmPasswordInput.addEventListener("input", checkPasswordMatch);

        function checkPasswordMatch() {
          const password = passwordInput.value;
          const confirmPassword = confirmPasswordInput.value;

          if (confirmPassword === "") {
            passwordMatch.textContent = "";
            passwordMatch.style.color = "";
          } else if (password === confirmPassword) {
            passwordMatch.textContent = "Passwords match";
            passwordMatch.style.color = "#28a745";
          } else {
            passwordMatch.textContent = "Passwords do not match";
            passwordMatch.style.color = "#dc3545";
          }
        }

        // Form submission
        signupForm.addEventListener("submit", async function (e) {
          e.preventDefault();

          // Get form values
          const userName = document.getElementById("userName").value;
          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;
          const confirmPassword =
            document.getElementById("confirmPassword").value;
          const terms = document.getElementById("terms").checked;

          // Basic validation
          if (!userName || !email || !password || !confirmPassword) {
            displayMsg("Please fill in all fields", "error");
            return;
          }

          if (!terms) {
            displayMsg(
              "Please agree to the Terms of Service and Privacy Policy",
              "error"
            );
            return;
          }

          if (password !== confirmPassword) {
            displayMsg("Passwords do not match", "error");
            return;
          }

          // Check password strength
          let strength = 0;
          if (password.length >= 8) strength += 25;
          if (/[A-Z]/.test(password)) strength += 25;
          if (/[0-9]/.test(password)) strength += 25;
          if (/[^A-Za-z0-9]/.test(password)) strength += 25;

          if (strength < 75) {
            displayMsg("Please use a stronger password", "error");
            return;
          }

          //  send the data to  backend

          try {
            const response = await fetch(
              "https://backendroutes-lcpt.onrender.com/esignup",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  username: userName,
                  email: email,
                  password: password,
                }),
              }
            );

            const data = await response.json();

            if (response.ok) {
              displayMsg(`${data.message}`, "success");
            } else {
              displayMsg(`${data.message}`, "error");
            }
          } catch (error) {
            console.error("Error:", error);
          }
        });

        function displayMsg(msg, msgClass) {
          msgContainer = document.getElementById("msg-display");
          msgContainer.classList.add(msgClass);
          msgContainer.style.opacity = 1;
          msgContainer.textContent = msg;

          setTimeout(() => {
            msgContainer.style.opacity = 0;
            msgContainer.textContent = "";
            msgContainer.classList.remove(msgClass);
          }, 2500);
        }

        // In a real implementation, you would redirect or handle the response
        // window.location.href = '/dashboard';
      });
    </script>
  </body>
</html>
