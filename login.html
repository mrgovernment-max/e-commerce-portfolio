<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login | Your Site</title>
    <link rel="stylesheet" href="login.css" />
    <script
      src="https://kit.fontawesome.com/a47fc389f5.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="login-container">
      <div class="login-header">
        <a href="index.html">
          <img
            src="https://mrgovernment-max.github.io/e-commerce-portfolio/images/logo.webp"
            alt="Brand Logo"
            class="logo"
        /></a>
        <h1>Welcome Back</h1>
      </div>

      <form class="login-form" id="loginForm">
        <div class="form-group">
          <label for="email">Email Address</label>
          <input
            type="email"
            id="email"
            class="form-control"
            placeholder="Enter your email"
            required
          />
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div class="password-container">
            <input
              type="password"
              id="password"
              class="form-control"
              placeholder="Enter your password"
              required
            />
            <button type="button" class="toggle-password" id="togglePassword">
              üëÅÔ∏è
            </button>
          </div>
        </div>

        <div class="remember-forgot">
          <a href="#" class="forgot-password">Forgot Password?</a>
        </div>

        <button id="login-btn" type="submit" class="login-btn">
          Sign In <i id="loader" class="fa-solid fa-spinner"></i>
        </button>
        <div id="login-info" class="login-info"></div>

        <div class="signup-link">
          Don't have an account? <a href="signup.html">Sign Up</a>
        </div>
      </form>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        const loginForm = document.getElementById("loginForm");
        const togglePassword = document.getElementById("togglePassword");
        const passwordInput = document.getElementById("password");
        const Loader = document.getElementById("loader");

        // Toggle password visibility
        togglePassword.addEventListener("click", function () {
          const type =
            passwordInput.getAttribute("type") === "password"
              ? "text"
              : "password";
          passwordInput.setAttribute("type", type);
          this.textContent = type === "password" ? "üëÅÔ∏è" : "üîí";
        });
      });

      // Form submission
      loginForm.addEventListener("submit", async function (e) {
        e.preventDefault();

        // Get form values
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        // Basic validation
        if (!email || !password) {
          alert("Please fill in all fields");
          return;
        }

        loader.style.display = "inline-block";

        try {
          const res = await fetch(
            "https://backendroutes-lcpt.onrender.com/elogin",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ email, password }),
            }
          );

          const data = await res.json();
          const message = data.message;

          loader.style.display = "none";

          console.log(message);

          if (message === "Invalid password") {
            displayMsg(`${message}`, "error");
          } else if (message === "Login successful") {
            displayMsg(`${message}`, "success");
          } else {
            displayMsg(`${message}`, "error");
          }
        } catch (err) {
          console.log(err);
        }
      });

      function displayMsg(msg, msgClass) {
        msgContainer = document.getElementById("login-info");
        msgContainer.classList.add(msgClass);
        msgContainer.style.opacity = 1;
        msgContainer.textContent = msg;

        setTimeout(() => {
          msgContainer.style.opacity = 0;
          msgContainer.textContent = "";
          msgContainer.classList.remove(msgClass);
        }, 2500);
      }
    </script>
  </body>
</html>
