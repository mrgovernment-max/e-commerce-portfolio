<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>To-Do List</title>
    <link id="stylesheet" rel="stylesheet" href="To-Do Task.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
  </head>
  <!-- Google tag (gtag.js) -->
  <script
    async
    src="https://www.googletagmanager.com/gtag/js?id=G-HHT3SEEJE3"
  ></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "G-HHT3SEEJE3");
  </script>
  <body>
    <header class="header-container">
      <div class="logo">
        <i class="fas fa-tasks"></i><a href="tasklog.html">TaskMaster</a>
      </div>
      <button class="theme" onclick="toggleStylesheet()" title="Toggle theme">
        <i class="fas fa-moon"></i>
      </button>
      <div class="auth">
        <a href="login.html">Login</a>
        <a href="signup.html">Sign up</a>
      </div>
    </header>
    <div class="todo-app-main" data-aos="fade-right" data-aos-duration="900">
      <div class="to-do" data-aos="fade-left" data-aos-duration="900">
        <h1>My To-Do List</h1>
        <input type="text" id="new-task" placeholder="Add a new task..." />
        <button class="add-task" onclick="addTask()">Add Task</button>
        <ul class="task-list" id="task-list"></ul>
      </div>
    </div>

    <div class="done-main">
      <header>Completed Tasks</header>
      <div class="done">
        <button class="clear-button" onclick="clearCompleted()">
          Clear Completed Tasks
        </button>

        <div>
          <ul class="completed-tasks">
            <!--completed tasks will render here dynamically-->
          </ul>
        </div>
      </div>
    </div>
    <script>
      function displaycompletedTask() {
        let see = "";
        const show = document.querySelector(".completed-tasks");
        const ctasks = JSON.parse(localStorage.getItem("complete")) || [];

        ctasks.forEach(
          (element, index) =>
            (see += `<li>${element.task}
                      <img
                          class="remove-icon"
                          onclick="removeCompletedTask(${index})"
                          src="./images/dustbin.jpg"
                          alt="remove"
                          onmouseover="this.src='./images/open-dustbin.jpg'"
                          onmouseout="this.src='./images/dustbin.jpg'">
                    </li>`)
        );

        show.innerHTML = see;
      }

      function removeCompletedTask(index) {
        const tasks = JSON.parse(localStorage.getItem("complete")) || [];
        tasks.splice(index, 1);
        localStorage.setItem("complete", JSON.stringify(tasks));
        displaycompletedTask();
      }

      function clearCompleted() {
        localStorage.setItem("complete", JSON.stringify([]));
        displaycompletedTask();
      }

      document.addEventListener("DOMContentLoaded", function () {
        AOS.init({ once: true, mirror: true });
        displayTask();
        displaycompletedTask();
      });

      let tasks = [];

      function toggleStylesheet() {
        document.body.classList.toggle("dark-theme");
        const themeBtn = document.querySelector(".theme i");
        if (document.body.classList.contains("dark-theme")) {
          themeBtn.classList.remove("fa-moon");
          themeBtn.classList.add("fa-sun");
          localStorage.setItem("theme", "dark");
        } else {
          themeBtn.classList.remove("fa-sun");
          themeBtn.classList.add("fa-moon");
          localStorage.setItem("theme", "light");
        }
      }

      function addTask() {
        const inputField = document.querySelector("#new-task");
        const input = inputField.value.trim();

        tasks = JSON.parse(localStorage.getItem("task")) || [];
        if (!input) return alert("Enter a task");

        tasks.push(input);
        localStorage.setItem("task", JSON.stringify(tasks));
        displayTask();
        inputField.value = "";
      }

      function displayTask() {
        let showContent = "";
        const show = document.getElementById("task-list");
        tasks = JSON.parse(localStorage.getItem("task")) || [];

        tasks.forEach((element, index) => {
          showContent += `<li>
              <span>${element}</span>
              <button title="Add to Completed Tasks" class='add-to-complete-button' onclick="addTocomplete('${element}', ${index})">âœ…</button>
              <img
                  class="remove-icon"
                  onclick="removeTask(${index})"
                  src="./images/dustbin.jpg"
                  alt="remove"
                  onmouseover="this.src='./images/open-dustbin.jpg'"
                  onmouseout="this.src='./images/dustbin.jpg'">
            </li>`;
        });

        show.innerHTML = showContent;
      }

      function removeTask(index) {
        tasks = JSON.parse(localStorage.getItem("task")) || [];
        tasks.splice(index, 1);
        localStorage.setItem("task", JSON.stringify(tasks));
        displayTask();
      }

      function addTocomplete(taskk, indexx) {
        let complete = JSON.parse(localStorage.getItem("complete")) || [];
        complete.push({ task: taskk });
        localStorage.setItem("complete", JSON.stringify(complete));
        displaycompletedTask();
        removeTask(indexx);
      }
    </script>
  </body>
</html>
